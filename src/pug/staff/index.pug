extends ../_layout.pug
block variables
  - title = "工作團隊 Staff"
block head
  link(rel="stylesheet", href="assets/css/base.css?version="+timestamp)
  link(rel="preload", href="assets/data/staff.json?version="+timestamp, as="fetch")
  link(rel="preconnect", href="https://gravatar.com")
block main
  #modal: .inner-modal.rounded-xl
    .modal-head.flex.px-4.pt-4.items-start
      header.head-group.flex.items-center.mb-2
        img#modal-avatar.rounded-full.shrink-0.w-20.bg-slate-100
        .flex.flex-col.items-stretch.mx-4
          h4#modal-title.font-bold
          h6#modal-subtitle
      button.modal-close.text-2xl.text-dark.ms-auto(aria-label="Close")
        i.fa-solid.fa-xmark
    .modal-body.px-4.pb-4
      article#modal-content.me-2.my-4
      section#modal-info.flex.items-center
        i.fa-solid.fa-earth-asia
        a#modal-website-link.mx-2(href="#", rel="external", target="_blank")
  main.container
    .my-20
      h1.border-b.border-neutral-500.pb-3(data-i18n="staff.title") 工作人員
      .text-sm.my-4(data-i18n="staff.subtitle") g0v Summit 2024 籌備團隊
    .my-20
      - let volunteers = {}
      - for (let volunteer of staff.members) volunteers[volunteer.id] = volunteer
      each team in staff.teams
        h4.mt-8.mb-4(id=team.id, data-i18n=`team.${team.id}`)= team.name.zh
        .grid.mb-6.items-start(class="grid-cols-3 md:grid-cols-6 gap-6")
          mixin staff-avatar(person_id)
            - let person = volunteers[person_id]
            - let clickable = !!(person?.website || person?.bio)
            - let alt = (person?.name) ? (person.name.zh || '') + (person.name.zh === person.name.en ? '' : ' ' + person.name.en) : person_id
            .staff.flex.flex-col.items-center.justify-center(id=person_id, data-id=person_id)
              a.w-full.flex.items-center.justify-center.aspect-square.bg-slate-100.rounded-full(href=(clickable ? (person.bio ? `staff/#${person_id}` : person.website) : null), rel="external")
                if person && person.avatar
                  img.w-full.rounded-full(src=person.avatar, alt=alt)
                else
                  img.rounded-full(src="assets/img/default-avatar.svg", aria-hidden)
              .mt-2.mb-4.text-center(data-i18n=`staff.${person_id}`, class=(person ? '' : 'text-red'))= person && person.name.zh
          each volunteer_id in team.members
            +staff-avatar(volunteer_id)
        if team.sections
          each section in team.sections
            h5.my-4(id=section.id, data-i18n=`team.section.${section.id}`)= section.name.zh
            .grid.mb-6.items-start(class="grid-cols-3 md:grid-cols-6 gap-6")
              each volunteer_id in section.members
                +staff-avatar(volunteer_id)
block script
  script.
    let staff
    $(function () {
      fetch('assets/data/staff.json')
        .then(response => response.json())
        .then(data => {
          staff = data
          let hash = window.location.hash
          if (hash)
            $('.staff[data-id="' + hash.substring(1) + '"]').trigger('click')
        })
    })

    $('.staff[data-id]').on('click', function (e) {
      let currentLang = i18n.locale
      let id = $(this).data('id')
      history.replaceState(null, null, window.location.pathname + '#' + id);
      let member = staff.members.filter(member => member.id == id)[0]

      $('#modal-avatar').attr('src', member.avatar)
      $('#modal-title').text(member.name[currentLang])
      $('#modal-subtitle').text(member.name[currentLang === 'en' ? 'zh' : 'en'])
        .toggleClass('hidden', member.name.zh === member.name.en)
      $('#modal-content').html(member.bio)
      $('#modal-info').toggleClass('hidden', !member.website)

      let link = member.website
      if (link.indexOf('//www.') >= 0) link = link.substring(link.indexOf('//www.') + 6, link.length)
      else if (link.indexOf('//') >= 0) link = link.substring(link.indexOf('//') + 2, link.length)
      $('#modal-website-link').attr('href', member.website || "#")
        .text((link.endsWith('/') ? link.substring(0, link.length - 1) : link) || '')

      $('body').addClass('overflow-hidden')
      $('#modal').addClass('show')
    })
